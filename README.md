# 12.8-HW
### Домашнее задание к занятию 12.8 - "Резервное копирование баз данных" - Семкин Вячеслав
***
### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

*Приведите ответ в свободной форме.*

**Ответ:**

- **Полный бэкап**. Каждый раз создается полная копия, содержащая все файлы источника. Данный метод лучше использоваться с небольшими БД, т.к. занимает много места на диске. Оптимальная периодичность создания полного бэкапа - 1 раз в сутки.
![1-1](https://github.com/SemkinVA/12.8-HW/blob/main/1-1.png)

- **Инкрементальный бэкап**. Копирование только новых и измененных файлов. Используется если объем исходных данных большой и для пользователя имеет значение время копирования файлов и экономия места на диске. Выставление периодичности создания бэкапа зависит от частоты изменеия данных в БД. Если меняеюся часто, то период можно установить в 1 час, если меняются редко (1-2 раза в день), то период можно установить 1-2 раза в день.
![1-2](https://github.com/SemkinVA/12.8-HW/blob/main/1-2.png)

- **Дифференциальный бэкап**. Копирование только добавленных и измененных файлов по сравнению с полной копией. Используется если объем исходных данных большой, файлы в исходной папке изменяются не слишком интенсивно, а простота и скорость восстановления файлов для пользователя являются критичными. Создание дифференциальных копий происходит достаточно быстро, если накопленных изменений с момента создания полной немного. Так же как и при инкрементном бэкапе, выставление периодичности создания бэкапа зависит от частоты изменеия данных в БД. Если меняеюся часто, то период можно установить в 1 час, если меняются редко (1-2 раза в день), то период можно установить 1-2 раза в день.
![1-3](https://github.com/SemkinVA/12.8-HW/blob/main/1-3.png)

1.1. С задачей справится быстрее всего **дифференциальный метод**, но в данном варианте впринципе можно использовать любой тип бэкапа.

1.2. С поставленной задачей необходимо использовать **инкрементный метод**.

1.3.* Такой переход возможен при использовании репликации **Master-Slave**

***
### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

*Приведите ответ в свободной форме.*

**Ответ:**

2.1. 
```
-- резервирование "pg_dump <параметры> <имя базы> > <файл, куда сохранить дамп>"
pg_dump my_bd > /tmp/my_bd.dump

-- pg_restore восстановление 
-- из бинарника:
pg_restore -Fc my_bd.bak

-- из тарбола:
pg_restore -Ft my_bd.tar

-- с созданием новой базы:
pg_restore -Ft -C my_bd.tar

-- с подключением к конкретному серверу и базе:
pg_restore -d "postgresql://user:user@localhost/user_base" -Fc my_bd.bak
```

2.1.* Процес можно автоматизировать скриптом:
```
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin

PGPASSWORD=password
export PGPASSWORD
pathB=/backup
dbUser=dbuser
database=db

find $pathB \( -name "*-1[^5].*" -o -name "*-[023]?.*" \) -ctime +61 -delete
pg_dump -U $dbUser $database | gzip > $pathB/pgsql_$(date "+%Y-%m-%d").sql.gz

unset PGPASSWORD
```

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

*Приведите ответ в свободной форме.*

**Ответ:**

3.1. Можно воспользоваться утилитой XtraBackup:
```
xtrabackup --backup --target-dir=/data/backups/inc1 --incremental-basedir=/data/backups/base
```
